CREATE TABLE "teams" (
  "id" INT,
  "user_id" INT UNIQUE REFERENCES users(id) ON DELETE CASCADE,
  "team_name" VARCHAR(100) NOT NULL,
  "league" VARCHAR(100) NOT NULL,
  "country" VARCHAR(100) NOT NULL,
  "formation" VARCHAR(20) NOT NULL,
  "home_stadium" VARCHAR(100) NOT NULL,
  "trophies_won" INT DEFAULT 0,
  "logo_url" TEXT,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id")
);

CREATE TABLE "scouts" (
  "id" SERIAL,
  "user_id" INT UNIQUE REFERENCES users(id) ON DELETE CASCADE,
  "first_name" VARCHAR(50) NOT NULL,
  "last_name" VARCHAR(50) NOT NULL,
  "phone" VARCHAR(20) UNIQUE NOT NULL,
  "nationality" VARCHAR(50) NOT NULL,
  "image_url" TEXT,
  "experience_years" INT,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id")
);

CREATE TABLE "players" (
  "id" INT,
  "user_id" INT UNIQUE REFERENCES users(id) ON DELETE CASCADE,
  "first_name" VARCHAR(100) NOT NULL,
  "last_name" VARCHAR(100) NOT NULL,
  "club" VARCHAR(50) NOT NULL,
  "image_url" TEXT,
  "position" VARCHAR(50) NOT NULL,
  "height" INT,
  "weight" INT,
  "nationality" VARCHAR(50) NOT NULL,
  "birthdate" DATE,
  "profile_video_url" TEXT,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id")
);

CREATE TABLE "trial_invitations" (
  "id" SERIAL,
  "player_id" INT  REFERENCES players(id) ON DELETE CASCADE,
  "team_id" INT  REFERENCES teams(id) ON DELETE CASCADE,
  "scout_id" INT REFERENCES scouts(id) ON DELETE SET NULL,
  "invitation_message" TEXT,
  "status" VARCHAR(20) CHECK (status IN ('pending', 'accepted', 'declined')) DEFAULT 'pending',
  "trial_date" DATE NOT NULL,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id"),
  CONSTRAINT "FK_trial_invitations.team_id"
    FOREIGN KEY ("team_id")
      REFERENCES "teams"("id"),
  CONSTRAINT "FK_trial_invitations.scout_id"
    FOREIGN KEY ("scout_id")
      REFERENCES "scouts"("id"),
  CONSTRAINT "FK_trial_invitations.player_id"
    FOREIGN KEY ("player_id")
      REFERENCES "players"("id")
);

CREATE TABLE "player_stats" (
  "player_id" INT REFERENCES players(id) ON DELETE CASCADE,
  "season" INT NOT NULL,
  "goals" INT DEFAULT 0,
  "assists" INT DEFAULT 0,
  "yellow_cards" INT DEFAULT 0,
  "red_cards" INT DEFAULT 0,
  "passes_completed" INT DEFAULT 0,
  "passes_accuracy" DECIMAL(5,2) CHECK (passes_accuracy BETWEEN 0 AND 100),
  "tackles" INT DEFAULT 0,
  "interceptions" INT DEFAULT 0,
  "shots_on_target" INT DEFAULT 0,
  "distance_covered_km" DECIMAL(4,2) DEFAULT 0.0,
  "rating" DECIMAL(4,2) CHECK (rating BETWEEN 0 AND 10),
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("player_id", "season"),
  CONSTRAINT "FK_player_stats.player_id"
    FOREIGN KEY ("player_id")
      REFERENCES "players"("id")
);

CREATE TABLE "users" (
  "id" SERIAL,
  "email" VARCHAR(255) UNIQUE NOT NULL,
  "password" TEXT NOT NULL,
  "role" VARCHAR(20) CHECK (role IN ('player', 'scout', 'team')) NOT NULL,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id")
);

CREATE TABLE "messages" (
  "id" SERIAL,
  "sender_id" INT REFERENCES users(id) ON DELETE CASCADE,
  "receiver_id" INT REFERENCES users(id) ON DELETE CASCADE,
  "message" TEXT NOT NULL,
  "sent_at" TIMESTAMP DEFAULT NOW(),
  "read" BOOLEAN DEFAULT FALSE,
  PRIMARY KEY ("id"),
  CONSTRAINT "FK_messages.sender_id"
    FOREIGN KEY ("sender_id")
      REFERENCES "users"("id"),
  CONSTRAINT "FK_messages.receiver_id"
    FOREIGN KEY ("receiver_id")
      REFERENCES "users"("id")
);

CREATE TABLE "shortlisted_players" (
  "id" SERIAL,
  "team_id" INT REFERENCES teams(id) ON DELETE CASCADE,
  "player_id" INT REFERENCES players(id) ON DELETE CASCADE,
  "shortlisted_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id"),
  CONSTRAINT "FK_shortlisted_players.team_id"
    FOREIGN KEY ("team_id")
      REFERENCES "teams"("id"),
  CONSTRAINT "FK_shortlisted_players.player_id"
    FOREIGN KEY ("player_id")
      REFERENCES "players"("id")
);

CREATE TABLE "scouts_recommendation" (
  "id" SERIAL,
  "scout_id" INT REFERENCES scouts(id) ON DELETE CASCADE,
  "player_id" INT  REFERENCES players(id) ON DELETE CASCADE,
  "team_id" INT  REFERENCES teams(id) ON DELETE CASCADE,
  "recommendation_note" TEXT,
  "created_at" TIMESTAMP DEFAULT NOW(),
  PRIMARY KEY ("id"),
  CONSTRAINT "FK_scouts_recommendation.team_id"
    FOREIGN KEY ("team_id")
      REFERENCES "teams"("id"),
  CONSTRAINT "FK_scouts_recommendation.scout_id"
    FOREIGN KEY ("scout_id")
      REFERENCES "scouts"("id"),
  CONSTRAINT "FK_scouts_recommendation.player_id"
    FOREIGN KEY ("player_id")
      REFERENCES "players"("id")
);

